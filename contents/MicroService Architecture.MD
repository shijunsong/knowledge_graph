### **SOA**？微服务？区别？

- SOA（Service-Oriented Architecture，**面向服务的架构**）

  定义

  > 是一种高层级的架构设计理念，可通过在网络上使用基于通用通信语言的服务接口，让软件组件可重复使用。  
  > SOA 集成了独立部署和维护的服务，并允许它们相互通信和协同工作，以构建一个跨不同系统的软件应用。  
  > 通过ESB（Enterprise Service Bus，**企业服务总线**）把企业中各个不同的服务连接在一起。  
  > ESB通过使用标准网络协议（如 SOAP、XML、JSON、MQ ）来开放服务以发送请求或访问数据，
  > 实现与各种系统间的协议转换、数据转换、透明的动态路由等功能，消除了开发人员必须从头开始进行集成的困扰

  优点

  > 减少服务依赖，松耦合

- MicroServices（微服务）

  > 一种软件架构风格，它是以专注于单一责任与功能的小型功能区块 (Small Building Blocks) 为基础，
  > 利用模块化的方式组合出复杂的大型应用程序，各功能区块使用与语言无关 (Language-Independent/Language agnostic）的API集相互通信。

- 对比

  | [`参考: SOA & 微服务`](https://cloud.tencent.com/developer/article/1985737) | SOA                                           | 微服务                              |
  | :----------------------------------------------------------- | :-------------------------------------------- | ----------------------------------- |
  | 服务粒度                                                     | 粗粒度                                        | 细粒度                              |
  | 业务划分方式                                                 | 水平多层                                      | 纵向业务划分                        |
  | 部署方式                                                     | 整体部署                                      | 独立部署                            |
  | 通信方式                                                     | 使用重量级通信方式，ESB充当服务之间通信的角色 | 使用轻量级通信方式，如HTTP RESTful  |
  | 服务交付                                                     | 交付慢                                        | 交付快                              |
  | 应用场景                                                     | 庞大、复杂、异构的企业级系统                  | 快速、轻量级、基于 Web 的互联网系统 |



### [如何保证接口幂等性](https://developer.aliyun.com/article/1588259)

- 使用唯一标识

  > 为每个请求分配一个唯一的标识，例如请求 ID 或流水号。  
  > 通过在请求中传递这个唯一标识，系统可以判断是否已经处理过该请求。

- 设计幂等的操作

  > 确保操作本身是幂等的。  
  > 例如，更新数据时可以采用"更新或插入"的策略，而不是直接修改已有记录。

- 使用事务

  > 在涉及多个数据库操作的情况下，使用事务来确保整个操作的原子性和幂等性。

- 利用缓存

  > 将请求的结果缓存起来，当接收到相同的请求时，直接返回缓存中的结果，避免重复执行操作。




### 谈谈对微服务的理解和优缺点

- 微服务是一种架构风格，通过将大型的单体应用划分为比较小的服务单元，从而降低整个系统的复杂度。

- 优点：

  > - 服务部署更灵活，耦合性降低。
  > - 技术更新灵活，可以根据业务特点，灵活选择技术栈。
  > - 应用的性能得到提高
  > - 更容易组合专门的团队
  > - 代码复用

- 缺点：

  > - 提高服务调用复杂性：网络问题、容错问题、负载问题、高并发问题等问题
  > - 分布式事务：尽量不要使用微服务事务。
  > - 增加测试难度
  > - 运维难度提升：对部署、监控、告警等要求就会变得复杂

### 如何拆分微服务

- 拆分基本准则：  

  1、微服务之间尽量不要有业务交叉。  
  2、微服务之前只能通过接口进行服务调用，而不能绕过接口直接访问对方的数据。  
  3、高内聚，低耦合。  
  4、尽量保证微服务的稳定 

- 高内聚低耦合：

  是一种从上而下指导微服务设计的方法。  
  实现工具： `同步的接口调用` 和 `异步的事件驱动` 两种方式。

- DDD： 

  在2004年，由Eric Evans提出了， DDD是面对软件复杂之道。  
  Domain-Driven- Design –Tackling Complexity in the Heart of Software   
  DDD只是一种方法论，没有一个稳定的技术框架  
  DDD要求领域是跟技术无关、跟存储无关、跟通信无关  
  DDD分为战略设计和战术设计。  

  > 上层的战略设计能够很好的指导中台划分，下层的战术设计能够很好的指导微服务搭建。

  - 贫血模型：Martin Fowler， 导致 贫血失忆症
  - 充血模型

- MVC架构：领域优先的四层架构

  <img src="../pictures/microservice/ddd.png"/>

  大泥团： 不利于微服务的拆分。大泥团结构拆分出来的微服务依然是泥团机构，
  当服务业务逐渐复杂，这个泥团又会膨胀成为大泥团。

- 中台

  将各个业务线中可以复用的一些功能抽取出来，剥离个性，提取共性，形成一些可复用的组件。
  三类 业务中台、数据中台和技术中台。 

- 中台跟DDD结合

  DDD会通过限界上下文将系统拆分成一个一个的领域， 而这种限界上下文，天生就成了中台之间的逻辑屏障。
  DDD在技术与资源调度方面都能够给中台建设提供不错的指导。

### 如何保证微服务敏捷开发

### 微服务的链路追踪

### 持续集成、AB发布要怎么做

开发运维一体化。

敏捷开发： 目的就是为了提高团队的交付效率，快速迭代，快速试错。

每个月固定发布新版本，以分支的形式保存到代码仓库中。快速入职。任务面板、站立会议。团队人员灵活流动，同时形成各个专家代表。测试环境- 生产环境 -》 开发测试环境SIT、集成测试环境、压测环境STR、预投产环境、生产环境PRD。文档优先。晨会、周会、需求拆分会。

链路追踪：

1、基于日志。 形成全局事务ID，落地到日志文件。 filebeat- logstash-Elasticsearch 形成大型报表。
2、基于MQ，往往需要架构支持。经过流式计算形成一些可视化的结果。

持续集成：SpringBoot  maven pom ->build -> shell ; Jenkins。

AB发布：
1、蓝绿发布、红黑发布。 老版本和新版本是同时存在的。
2、灰度发布、金丝雀发布。



















